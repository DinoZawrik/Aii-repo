# Отчёт по итоговому проекту по курсу «Инженерия Искусственного Интеллекта»

---

## 1. Паспорт проекта

- **Название проекта:** Sentiment Analysis API - Сервис анализа тональности текстов
- **Автор:** Новиков Максим Петрович
- **Группа:** БСБО-05-23
- **Контакт:** @telegram
- **Ссылка на репозиторий:** GitHub

Проект реализует REST API сервис для определения тональности текстовых отзывов. Используются методы машинного обучения (TF-IDF + классические алгоритмы) для бинарной классификации текстов на положительные и отрицательные. Сервис принимает текст и возвращает предсказание с уровнем уверенности.

---

## 2. Постановка задачи и контекст

### 2.1. Предметная область и задача

**Задача:** Бинарная классификация текстовых отзывов по тональности (sentiment analysis).

**Потенциальные пользователи:**
- E-commerce платформы для анализа отзывов о товарах
- Службы поддержки для приоритизации обращений
- Маркетинговые аналитики для мониторинга упоминаний бренда

**Сценарий использования:** Пользователь отправляет текст отзыва через API, получает предсказание тональности (positive/negative) с уровнем уверенности.

### 2.2. Формулировка задачи в терминах ML

- **Входные данные:** Текстовый отзыв (строка)
- **Целевая переменная:** Бинарная метка (0 = негативный, 1 = позитивный)
- **Выход модели:** Класс + вероятность принадлежности к классу

**Требования:**
- Точность (Accuracy) > 85%
- Латентность < 100ms на запрос
- Простота развёртывания (Docker)

### 2.3. Целевые метрики качества

| Метрика | Обоснование |
|---------|-------------|
| **Accuracy** | Основная метрика при сбалансированных классах |
| **Precision** | Важна для минимизации ложных срабатываний |
| **Recall** | Важна для полноты обнаружения |
| **F1-Score** | Баланс между Precision и Recall |

Классы в датасете сбалансированы (50/50), поэтому Accuracy является адекватной основной метрикой.

---

## 3. Данные

### 3.1. Источник данных

Используется **синтетический демонстрационный датасет** `data/sentiment_data.csv`:
- 100 текстовых отзывов на английском языке
- Сгенерированы на основе типичных шаблонов положительных и отрицательных отзывов
- Сбалансированные классы: 50 положительных, 50 отрицательных

### 3.2. Структура данных

| Колонка | Тип | Описание |
|---------|-----|----------|
| `text` | string | Текст отзыва |
| `label` | int | Метка класса (0 или 1) |

### 3.3. Предобработка и EDA

**Шаги предобработки:**
1. Приведение к нижнему регистру
2. Удаление URL и email адресов
3. Удаление пунктуации
4. Нормализация пробелов

**Наблюдения из EDA (`notebooks/01_eda.ipynb`):**
- Классы идеально сбалансированы (50/50)
- Нет пропущенных значений
- Средняя длина текста: ~45 символов, ~8 слов
- Ключевые слова:
  - Положительные: "love", "great", "amazing", "excellent"
  - Отрицательные: "terrible", "awful", "horrible", "worst"

---

## 4. Модели и подходы

### 4.1. Baseline модели

Для извлечения признаков использовался **TF-IDF** векторизатор:
- `max_features=5000`
- `ngram_range=(1, 2)` - униграммы и биграммы

**Протестированные алгоритмы:**

| Модель | Описание |
|--------|----------|
| Logistic Regression | Линейный классификатор, `max_iter=1000` |
| Random Forest | Ансамбль деревьев, `n_estimators=100` |
| SVM (Linear) | Метод опорных векторов с линейным ядром |

### 4.2. Эксперименты

Эксперименты проведены в `notebooks/02_model_experiments.ipynb`:
- Train/Test split: 80/20 со стратификацией
- 5-fold Cross-Validation для оценки стабильности

### 4.3. Архитектура Transformer (опционально)

Реализована поддержка transformer моделей (`src/models/transformer.py`):
- Модель: DistilBERT (distilbert-base-uncased)
- Max length: 512 токенов
- Fine-tuning на downstream задаче

*Примечание: Transformer модель требует GPU для эффективного обучения.*

---

## 5. Экспериментальный протокол и результаты

### 5.1. Экспериментальный протокол

1. **Разделение данных:** 80% train / 20% test, stratified split
2. **Кросс-валидация:** 5-fold CV на train
3. **Метрики:** Accuracy, Precision, Recall, F1

### 5.2. Сравнение моделей по метрикам

| Модель | Accuracy | Precision | Recall | F1-Score | Комментарий |
|--------|----------|-----------|--------|----------|-------------|
| Logistic Regression | **0.95** | **0.95** | **0.95** | **0.95** | Финальная модель |
| Random Forest | 0.90 | 0.90 | 0.90 | 0.90 | Склонен к переобучению |
| SVM (Linear) | 0.95 | 0.95 | 0.95 | 0.95 | Аналогично LogReg |

**Cross-Validation Results (5-fold):**
- Logistic Regression: 0.94 (+/- 0.06)
- Random Forest: 0.88 (+/- 0.10)
- SVM: 0.94 (+/- 0.06)

### 5.3. Выбор финальной модели

**Выбрана: Logistic Regression**

**Обоснование:**
1. Высокая точность на тестовой выборке (~95%)
2. Стабильные результаты на кросс-валидации
3. Быстрый инференс (< 10ms)
4. Интерпретируемость (можно анализировать веса признаков)
5. Простота развёртывания

**Trade-offs:**
- Линейная модель может хуже работать на сложных текстах
- Для лучшего качества стоит использовать transformer модели

---

## 6. Архитектура решения и сервис

### 6.1. Архитектура пайплайна

```
[Input Text]
     │
     ▼
[TextPreprocessor] ─── lowercase, remove punct/urls
     │
     ▼
[TfidfFeatureExtractor] ─── fit_transform / transform
     │
     ▼
[BaselineModel] ─── predict / predict_proba
     │
     ▼
[API Response] ─── sentiment, confidence, latency
```

### 6.2. API Endpoints

| Endpoint | Метод | Описание |
|----------|-------|----------|
| `/` | GET | Информация об API |
| `/health` | GET | Health check |
| `/predict` | POST | Предсказание для одного текста |
| `/predict/batch` | POST | Пакетное предсказание |
| `/docs` | GET | Swagger UI документация |

**Формат запроса `/predict`:**
```json
{"text": "This product is amazing!"}
```

**Формат ответа:**
```json
{
  "text": "This product is amazing!",
  "sentiment": "positive",
  "confidence": 0.95,
  "label": 1,
  "latency_ms": 12.5
}
```

### 6.3. Технологический стек

| Компонент | Технология |
|-----------|------------|
| API Framework | FastAPI |
| ML | scikit-learn, transformers |
| Data | pandas, numpy |
| Logging | structlog |
| Containerization | Docker, docker-compose |
| Testing | pytest |

---

## 7. Наблюдаемость, конфигурация и безопасность

### 7.1. Логи и наблюдаемость

- **Структурированное логирование** через `structlog`
- **Логируемые события:**
  - Загрузка модели при старте
  - Каждый запрос предсказания (текст, результат, латентность)
  - Ошибки и исключения
- **Health check:** `/health` endpoint для мониторинга

### 7.2. Конфигурации

**Переменные окружения (`.env.example`):**
- `MODEL_TYPE` - тип модели
- `MODEL_PATH` - путь к модели
- `API_HOST`, `API_PORT` - настройки сервера
- `LOG_LEVEL`, `LOG_FORMAT` - настройки логирования

**YAML конфиги (`configs/`):**
- `model_config.yaml` - параметры моделей
- `training_config.yaml` - параметры обучения

### 7.3. Безопасность

- `.env` добавлен в `.gitignore`
- `.env.example` содержит только placeholder'ы
- Нет реальных секретов в репозитории
- Синтетические данные (без PII)

---

## 8. Ограничения и дальнейшая работа

### 8.1. Текущие ограничения

1. **Данные:** Небольшой синтетический датасет (100 записей)
2. **Классификация:** Только бинарная (нет нейтрального класса)
3. **Язык:** Только английский
4. **Модель:** Baseline без deep learning

### 8.2. Направления развития

**Улучшения модели:**
- Fine-tune BERT/DistilBERT на реальных данных
- Добавить нейтральный класс (3-class classification)
- Мультиязычная поддержка

**Улучшения сервиса:**
- Авторизация (JWT/API keys)
- Rate limiting
- Кэширование предсказаний
- Prometheus metrics

**Улучшения данных:**
- Интеграция с реальными датасетами (SST-2, IMDB)
- Активное обучение для улучшения модели

---

## 9. Сценарий демонстрации на защите

### 9.1. Что запускается

1. **API сервис:** `python -m src.service.app`
2. **Jupyter ноутбуки:** EDA и эксперименты

### 9.2. Ключевые сценарии

**Сценарий 1: Демонстрация API**
```bash
# Запуск сервиса
python -m src.service.app

# Тест через curl
curl -X POST http://localhost:8000/predict \
  -H "Content-Type: application/json" \
  -d '{"text": "This product is amazing!"}'
```

**Сценарий 2: Swagger UI**
- Открыть http://localhost:8000/docs
- Выполнить запросы через интерактивный интерфейс

### 9.3. На что обратить внимание

1. **Структура кода:** Модульная организация в `src/`
2. **Качество модели:** ~95% accuracy на тестовых данных
3. **Скорость:** Латентность < 20ms
4. **Документация:** README.md, docstrings, Swagger

---
